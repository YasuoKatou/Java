<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="yks.ticket.lite.dao.TicketDao">
  <resultMap id="ticketResultMap" type="yks.ticket.lite.entity.TicketEntity" autoMapping="true">
  </resultMap>

  <sql id="ticketAllColumns">
        T1.id  --チケットID
      , T1.title  --チケットタイトル
      , T1.description  --チケットの説明
      , T1.status_id  --チケットステータスID
      , T1.start_date  --開始日
      , T1.finish_date  --終了日
      , T1.progress_id  --チケットの進捗
      , T1.kind_id  --種類ID
      , T1.priority_id  --優先順位ID
      , T1.project_id  --プロジェクトID
      , T1.createDate  --作成日時
      , T1.createUserId  --作成者ID
      , T1.updateDate  --更新日時
      , T1.updateUserId  --更新者ID
      , T1.versionNo  --バージョンNo
  </sql>

  <select id="findByProject" resultMap="ticketResultMap">
    select
    <include refid="ticketAllColumns"/>
    from t_ticket T1
    where T1.project_id = #{project_id}
    order by T1.id
  </select>

  <select id="findById" resultMap="ticketResultMap">
    select
    <include refid="ticketAllColumns"/>
    from t_ticket T1
    where T1.id = #{id}
  </select>

  <select id="findMaxId" resultType="Long">
    select coalesce(max(T1.id), 0)
    from t_ticket T1
  </select>

  <insert id="append">
    insert into t_ticket (
        id  --チケットID
      , title  --チケットタイトル
      , description  --チケットの説明
      , status_id  --チケットステータスID
      , start_date  --開始日
      , finish_date  --終了日
      , progress_id  --チケットの進捗
      , kind_id  --種類ID
      , priority_id  --優先順位ID
      , project_id  --プロジェクトID
      , createUserId  --作成者ID
      , updateUserId  --更新者ID
    ) values (
        #{id}
      , #{title}
      , #{description}
      , #{status_id}
      , #{start_date}
      , #{finish_date}
      , #{progress_id}
      , #{kind_id}
      , #{priority_id}
      , #{project_id}
      , #{createUserId}
      , #{createUserId}
    )
  </insert>
</mapper>